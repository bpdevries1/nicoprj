alter table files add column filesize_int integer;
alter table files add column loc_type;
alter table files add column loc_detail;

update files
set filesize_int = cast(filesize as integer);

; test: orig
select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize filesize1, f1.md5sum md5sum1, 
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize filesize2, f2.md5sum md5sum2 
             from files f1, files f2
             where cast(f1.filesize as integer) > 10000000 
             and cast(f1.filesize as integer) = cast(f2.filesize as integer)
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 2;

; snel:
select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize filesize1, f1.md5sum md5sum1, 
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize filesize2, f2.md5sum md5sum2 
             from files f1, files f2
             where id1=4 
             and cast(f1.filesize as integer) > 10000000 
             and cast(f1.filesize as integer) = cast(f2.filesize as integer)
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 1;
; ok in sqlite

; alles met filesize_int:
select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1, 
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2 
             from files f1, files f2
             where id1=4 
             and f1.filesize_int > 10000000 
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 1;

; ook goed, wel index maken nog, ook op andere kolommen straks
create index ix_filesize_int on files (filesize_int);

; nog een keer, met index:
select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1, 
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2 
             from files f1, files f2
             where id1=4 
             and f1.filesize_int > 10000000 
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 5;
; limit 5: keert meteen terug met 1 result-rij.

db eval "select * from files where id=4"
# doet het goed en snel.

set query "select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1, 
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2 
             from files f1, files f2
             where id1=4 
             and f1.filesize_int > 10000000 
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 5"
             
db eval $query
# doet het ook meteen snel en goed.

# terug naar sqlite en 2 kolommen vullen.

;;;;; vanaf hieronder moet nog ;;;;;;;

update files
set loc_type = 'backup', loc_detail = 'laptop'
where folder like '%backups/YmorLaptop%';
; hierna count: 473479 zijn backup

update files
set loc_type = 'backup', loc_detail = 'pcubuntu'
where folder like '%backups/pcubuntu%';

update files
set loc_type = 'cache', loc_detail = 'c-bieb'
where folder like '%C:/bieb%';

update files
set loc_type = 'cache', loc_detail = 'c-media'
where folder like '%C:/media%';

update files
set loc_type = 'cache', loc_detail = 'c-install'
where folder like '%C:/install%';

update files
set loc_type = 'extrabackup', loc_detail = 'e-drive'
where folder like '%/media/e drive%';

update files
set loc_type = 'extrabackup', loc_detail = 'f-drive'
where folder like '%/media/f backup-c%';

update files
set loc_type = 'cache', loc_detail = 'dropbox-laptop'
where folder like 'C:/nico/Dropbox%';

update files
set loc_type = 'cache', loc_detail = 'dropbox-ubuntu'
where folder like '/home/nico/Dropbox%';

; check: count met group by
select count(*), loc_type, loc_detail
from files
group by loc_type, loc_detail
order by loc_type, loc_detail;

1606197||
473479|backup|laptop
37494|backup|pcubuntu
4373|cache|c-bieb
45801|cache|c-install
3|cache|c-media
2220|cache|dropbox-laptop
6151|cache|dropbox-ubuntu
30219|cache|e-drive
264498|cache|f-drive

; dropbox counts zijn niet hetzelfde, kan zijn omdat ik de catalog op verschillende momenten heb gemaakt.
; maar ruim 1.6 miljoen source files dus.

;; heeft het zin hier een index op te zetten? aantal verschillende waarden is beperkt.

;; alles wat nu geen location type heeft, is automatisch source?
; impliciet houden.

; query in tcl script geeft geen results, wel heel snel.
; even in sqlite:

select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1,
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2
             from files f1, files f2
             where f1.filesize_int > 10000000
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             and f1.loc_type = ''
             and f2.loc_type = ''
             limit 50;
; in sqlite ook leeg

; zonder loc_type check:
select f1.id id1, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1,
                    f2.id id2, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2
             from files f1, files f2
             where f1.filesize_int > 10000000
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 50;
; wel resultaten, even limit 2:
select f1.id id1, f1.loc_type, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1,
                    f2.id id2, f2.loc_type, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2
             from files f1, files f2
             where f1.filesize_int > 10000000
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             limit 2;
; 2 resultaten: leeg, cache allebei
; dit in check opnemen:
select f1.id id1, f1.loc_type, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1,
                    f2.id id2, f2.loc_type, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2
             from files f1, files f2
             where f1.filesize_int > 10000000
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             and f1.loc_type = ''
             limit 2;
; zo moet 'ie ze nog steeds vinden, of is null.
; vindt zo niets, nu is null:
select f1.id id1, f1.loc_type, f1.folder folder1, f1.filename filename1, f1.filesize_int filesize1, f1.md5sum md5sum1,
                    f2.id id2, f2.loc_type, f2.folder folder2, f2.filename filename2, f2.filesize_int filesize2, f2.md5sum md5sum2
             from files f1, files f2
             where f1.filesize_int > 10000000
             and f1.filesize_int = f2.filesize_int
             and f1.md5sum = f2.md5sum
             and f1.id < f2.id
             and f1.loc_type is null
             limit 2;
; en dan wel weer, mooi.

; in tcl doet 'ie het nu ook, en is heel snel.

; is ook een cache.
update files
set loc_type = 'cache', loc_detail = 'cache-singles'
where folder like '/media/nas/media/Music/Singles%';

; ook source zetten in db, anders teveel in .tcl file
update files
set loc_type = 'source', loc_detail = 'nas-media'
where folder like '/media/nas/media%'
and loc_type is null;
; niet singles overschrijven!

update files
set loc_type = 'source', loc_detail = 'nas-install'
where folder like '/media/nas/install%'
and loc_type is null;

update files
set loc_type = 'archive', loc_detail = 'nas-archief'
where folder like '/media/nas/archief%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'nas-bieb'
where folder like '/media/nas/bieb%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'nas-nico'
where folder like '/media/nas/nico%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'nas-pckopie'
where folder like '/media/nas/PC-kopie%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'nas-perfeng'
where folder like '/media/nas/perfeng%'
and loc_type is null;


update files
set loc_type = 'source', loc_detail = 'c-bin'
where folder like 'C:/bin%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-develop'
where folder like 'C:/develop%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-cruiseresults'
where folder like 'C:/cruiseresults%'
and loc_type is null;


update files
set loc_type = 'source', loc_detail = 'c-docset'
where folder like 'C:/Documents and Settings%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-home'
where folder like 'C:/home%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-Installatie'
where folder like 'C:/Installatie%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-Intel'
where folder like 'C:/Intel%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-LoginVSI'
where folder like 'C:/LoginVSI%'
and loc_type is null;


update files
set loc_type = 'source', loc_detail = 'c-MySQL'
where folder like 'C:/MySQL%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-nico'
where folder like 'C:/nico%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-perfeng'
where folder like 'C:/perfeng%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-perftoolset'
where folder like 'C:/perftoolset%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-Program Files'
where folder like 'C:/Program Files%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-progs'
where folder like 'C:/progs%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-projecten'
where folder like 'C:/projecten%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-util'
where folder like 'C:/util%'
and loc_type is null;

update files
set loc_type = 'source', loc_detail = 'c-WINDOWS'
where folder like 'C:/WINDOWS%'
and loc_type is null;

sqlite> delete from files where folder like '%archief/Ordina/projecten/ITX/Remote/svn%/.svn/%';

sqlite> delete from files where folder like '%archief/Ordina/projecten/Computer-
1996%';

update files
set loc_type = 'source', loc_detail = 'ubuntu-perftoolset'
where folder like '/home/nico/perftoolset%'
and loc_type is null;

delete from files where folder like '/home/nico/.fr%';

update files
set loc_type = 'cache', loc_detail = 'neilyoung-bestof'
where folder like '/media/nas/media/Music/Albums/Neil Young/Neil Young - Best of%';

delete from files where folder like '/media/nas/media/Music/Albums/African Chill/African Chill%';

update files
set loc_type = 'source', loc_detail = 'aaa'
where folder like '%/aaa%'
and loc_type is null;

update files
set loc_type = 'system', loc_detail = 'windows'
where folder like '%C:/WINDOWS%';

update files
set loc_type = 'system', loc_detail = 'windows'
where folder like '%C:/Program Files%';

update files
set loc_type = 'system', loc_detail = 'develop'
where folder like '%C:/develop%';

delete from files where folder like '/media/nas/backups/Retrospect%';

; 4-2-2012 added:
update files
set loc_type = 'oldbackup', loc_detail = 'delllaptop'
where folder like '/media/nas/backups/DellLaptop%';

update files
set loc_type = 'oldbackup', loc_detail = 'dellpc'
where folder like '/media/nas/backups/DellPC%';

update files
set loc_type = 'oldbackup', loc_detail = 'lap-imp'
where folder like '/media/nas/backups/laptop-important%';

; temporary check files, only set if not already set.
; locations: /media/nas/aaa, c:\aaa, /home/nico/aaa
update files
set loc_type = 'aaa', loc_detail = 'aaa'
where folder like '%/aaa%'
and loc_type is null;

; dingen QTP dubbel ymor-tooling en Roy
delete from files
where folder like 'C:/install/Roy-12-05-11/qtp/DVD%';

select count(*)
from files
where folder like 'C:/install/Roy-12-05-11/qtp/DVD%';

; 5-2-2012 alles in oldbackup verwijderd groter dan 10MB en elders aanwezig, nu nog dingen groter dan 10MB?
select *
from files
where loc_type = 'oldbackup'
and filesize_int >= 10000000
limit 10;
; komen zeker voor.

select *
from files
where loc_type = 'oldbackup'
and filesize_int >= 10000000
limit -1;

select count(*)
from files
where folder like '/media/nas/backups/laptop-important/d/util/soapui-2.5%';

; op 1 regel
select * from files where loc_type = 'oldbackup' and filesize_int >= 10000000 limit 10;

; 26-2-2012
update files
set loc_type = 'source', loc_detail = 'home-nico'
where folder like '/home/nico%'
and loc_type is null;

update files
set loc_type = 'system', loc_detail = 'SWSetup'
where folder like 'C:/SWSetup%'
and loc_type is null;

update files
set loc_type = 'system', loc_detail = 'media-FAT'
where folder like '/media/FAT%'
and loc_type is null;

update files
set loc_type = 'archive', loc_detail = 'nas-archief'
where folder like '/media/nas/archief%'
and loc_type is null;


; source/nas-archief had ik al, dus 2 aanpassingen:
; hierboven aangepast, deze 2 niet meer nodig
; update files
; set loc_type = 'archive', loc_detail = 'nas-archief'
; where loc_type = 'archive' and loc_detail = 'media-nas-archief';
; 
; update files
; set loc_type = 'archive', loc_detail = 'nas-archief'
; where loc_type = 'source' and loc_detail = 'nas-archief';

; c:/perftest heb ik niet meer.
delete from files
where folder like 'C:/perftest%';


