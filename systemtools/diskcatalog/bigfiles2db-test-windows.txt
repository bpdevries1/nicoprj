Bigfile2db probleem onder windows
=================================
* Clojure onder bash
  - eerst onder 4NT/cmd  
  - lein exec bigfiles2db.clj -r c:/ -db "c:/nico/projecten/diskusage/bigfiles.db"
    => start wel, db/table gemaakt, hierna niets, foutmelding: 
      #<ArityException clojure.lang.ArityException: Wrong number of args (1) passed to: core$map>
  - async-test.clj => ok.
  - lein exec removelinks-db.clj -db "c:/nico/projecten/diskusage/bigfiles.db" => ok, doet niets, want db leeg.
  - lein exec bigfiles2db.clj -r "c:/nico/projecten/diskcatalog" -db "c:/nico/projecten/diskusage/bigfiles.db"
    -> zelfde foutmelding

Opties
------
* print regels in code, dingen uitcommentarieren.
* repl starten en hierin dingen doen, dan wel libs beschikbaar?


(def args ["bigfiles2db.clj" "-r" "c:/nico/projecten/diskcatalog" "-db" "c:/nico/projecten/diskusage/bigfiles.db"])
(def opts (first (cli (rest args)
            ["-h" "--help" "Print this help"
                  :default false :flag true]
            ["-t" "--treshold" "Treshold for big files in bytes" 
                  :default 10e6 :parse-fn #(Float. %)]
            ["-db" "--database" "Database path" :default "~/projecten/diskusage/bigfiles.db"]
            ["-d" "--deletedb" "Delete DB before reading"
                  :default false :flag true]
            ["-r" "--root" "Root directory to find big files in"])))
(big-files (:root opts) (:treshold opts)) -> arity exception.
(def cal-format (java.text.SimpleDateFormat. "yyyy-MM-dd hh:mm:ss"))

(def root-dir (:root opts))
(def treshold (:treshold opts))

(->> (find-files-nolink root-dir #".*")
         (filter #(> (fs/size %) treshold))
         (filter #(fs/file? %))
         (filter #(not (fs/link? %))
         (map #(hash-map :fullpath (str %)
                         :folder (fs/parent %)
                         :filename (fs/base-name %)
                         :filesize (fs/size %)
                         :ts_cet (.format cal-format (fs/mod-time %))))))
-> arity exception
; zonder map:
						 
(->> (find-files-nolink root-dir #".*")
         (filter #(> (fs/size %) treshold))
         (filter #(fs/file? %))
         (filter #(not (fs/link? %))

; bugfix gedaan: haakjes.
		 
(big-files (:root opts) (:treshold opts)) -> ok!

in ndvreeze@laptop-nico:34:3:/cygdrive/c/nico/nicoprj/systemtools/diskcatalog
lein exec bigfiles2db.clj -r "c:/nico/projecten/diskcatalog" -db "c:/nico/projecten/diskusage/bigfiles.db"
-> ok, dan hele schijf:

lein exec bigfiles2db.clj -r "c:/" -db "c:/nico/projecten/diskusage/bigfiles.db"
; mss security fouten, net als bij backup.
-> lekker bezig, wel kijken naar backslashes in db, mss dubbel, mss enkel, wil liever forward slashes, zoals met Tcl.
-> zowaar helemaal klaar, geen meldingen!



